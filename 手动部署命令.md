# 手动部署命令

## 服务器信息
- **IP**: 38.175.195.104
- **用户名**: root
- **密码**: 0iHSn3CpCpDmlkub
- **部署路径**: /var/www/maclock

## 步骤 1: 上传文件到服务器

### 方式一: 使用 scp（推荐）

```bash
# 如果 deploy-temp 目录存在，直接上传
sshpass -p '0iHSn3CpCpDmlkub' scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/

# 如果 deploy-temp 不存在，先创建并准备文件
# 在项目根目录执行：
mkdir -p deploy-temp
rsync -av --progress \
    --exclude 'node_modules' \
    --exclude '.next' \
    --exclude '.git' \
    --exclude 'deploy-temp' \
    --exclude 'Maclock' \
    --exclude '.env.local' \
    --exclude '.env' \
    --exclude '*.log' \
    --exclude '.DS_Store' \
    --exclude 'tsconfig.tsbuildinfo' \
    ./ deploy-temp/

# 然后上传
sshpass -p '0iHSn3CpCpDmlkub' scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/
```

### 方式二: 使用 tar + scp（更快，适合大文件）

```bash
# 创建压缩包
tar -czf deploy.tar.gz \
    --exclude='node_modules' \
    --exclude='.next' \
    --exclude='.git' \
    --exclude='deploy-temp' \
    --exclude='Maclock' \
    --exclude='.env.local' \
    --exclude='.env' \
    --exclude='*.log' \
    --exclude='.DS_Store' \
    --exclude='tsconfig.tsbuildinfo' \
    .

# 上传压缩包
sshpass -p '0iHSn3CpCpDmlkub' scp -o StrictHostKeyChecking=no deploy.tar.gz root@38.175.195.104:/var/www/maclock/

# 连接到服务器解压
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 << 'EOF'
cd /var/www/maclock
tar -xzf deploy.tar.gz
rm deploy.tar.gz
EOF
```

## 步骤 2: 上传部署脚本

```bash
sshpass -p '0iHSn3CpCpDmlkub' scp -o StrictHostKeyChecking=no deploy-complete.sh root@38.175.195.104:/var/www/maclock/
```

## 步骤 3: 连接到服务器并执行部署

```bash
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104
```

在服务器上执行：

```bash
cd /var/www/maclock

# 设置权限
chmod +x deploy-complete.sh 2>/dev/null || true
chmod +x quick-deploy.sh 2>/dev/null || true

# 安装/更新依赖
npm install

# 执行部署脚本
./deploy-complete.sh

# 或者如果没有部署脚本，手动执行：
# rm -rf .next
# npm run build
# pm2 restart maclock || pm2 start npm --name maclock -- start
```

## 一键命令（复制粘贴执行）

```bash
# 1. 准备文件（如果 deploy-temp 不存在）
mkdir -p deploy-temp && rsync -av --progress --exclude 'node_modules' --exclude '.next' --exclude '.git' --exclude 'deploy-temp' --exclude 'Maclock' --exclude '.env.local' --exclude '.env' --exclude '*.log' --exclude '.DS_Store' --exclude 'tsconfig.tsbuildinfo' ./ deploy-temp/

# 2. 上传文件
sshpass -p '0iHSn3CpCpDmlkub' scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/

# 3. 上传部署脚本
sshpass -p '0iHSn3CpCpDmlkub' scp -o StrictHostKeyChecking=no deploy-complete.sh root@38.175.195.104:/var/www/maclock/

# 4. 执行部署
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'cd /var/www/maclock && chmod +x deploy-complete.sh && npm install && ./deploy-complete.sh'
```

## 检查部署状态

```bash
# 检查 PM2 状态
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'pm2 status'

# 查看日志
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'pm2 logs maclock --lines 50'

# 检查端口
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'netstat -tulpn | grep 3000 || ss -tulpn | grep 3000'
```

