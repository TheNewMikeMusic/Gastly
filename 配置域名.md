# 域名配置指南

本指南将帮助您将网站映射到80端口，使用自定义域名访问。

## 前置要求

1. ✅ 已购买域名
2. ✅ 域名DNS已解析到服务器IP地址
3. ✅ 服务器已安装Nginx
4. ✅ Next.js应用运行在3000端口

## 方法一：使用自动配置脚本（推荐）

### 1. 上传脚本到服务器

```bash
# 在本地执行（Windows PowerShell）
scp setup-domain.sh user@your-server-ip:/home/user/
```

### 2. 在服务器上执行脚本

```bash
# SSH连接到服务器
ssh user@your-server-ip

# 赋予执行权限
chmod +x setup-domain.sh

# 运行脚本（需要sudo权限）
sudo ./setup-domain.sh
```

### 3. 按提示输入域名

脚本会提示您输入域名，例如：
```
请输入您的域名 (例如: example.com): yourdomain.com
```

脚本会自动：
- ✅ 创建Nginx配置文件
- ✅ 配置80端口监听
- ✅ 测试配置是否正确
- ✅ 重启Nginx服务

## 方法二：手动配置

### 1. 编辑Nginx配置文件

```bash
sudo nano /etc/nginx/sites-available/maclock
```

### 2. 复制配置内容

使用项目中的 `nginx-domain.conf` 文件内容，将 `YOUR_DOMAIN.com` 替换为您的实际域名。

### 3. 创建符号链接

```bash
sudo ln -s /etc/nginx/sites-available/maclock /etc/nginx/sites-enabled/
```

### 4. 测试并重启Nginx

```bash
# 测试配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx
```

## 验证配置

### 1. 检查Nginx状态

```bash
sudo systemctl status nginx
```

### 2. 测试域名访问

```bash
curl -I http://yourdomain.com
```

应该返回HTTP 200状态码。

### 3. 在浏览器中访问

打开浏览器，访问 `http://yourdomain.com`，应该能看到网站内容。

## 防火墙配置

确保防火墙已开放80端口：

### Ubuntu/Debian (UFW)

```bash
sudo ufw allow 80/tcp
sudo ufw reload
```

### CentOS/RHEL (firewalld)

```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload
```

## 云服务器安全组配置

如果使用云服务器（阿里云、腾讯云、AWS等），需要在控制台配置安全组规则：

1. 登录云服务器控制台
2. 找到安全组设置
3. 添加入站规则：
   - 协议：TCP
   - 端口：80
   - 源：0.0.0.0/0

## DNS解析配置

确保域名DNS已正确解析：

### A记录配置

```
类型: A
主机记录: @ (或留空)
记录值: 您的服务器IP地址
TTL: 600
```

### 可选：WWW子域名

```
类型: A
主机记录: www
记录值: 您的服务器IP地址
TTL: 600
```

## 常见问题

### 1. 502 Bad Gateway

**原因**：Next.js应用未运行或端口不正确

**解决方法**：
```bash
# 检查应用是否运行
pm2 list

# 如果没有运行，启动应用
pm2 start npm --name "maclock" -- start
```

### 2. 无法访问域名

**检查清单**：
- ✅ DNS解析是否正确（使用 `nslookup yourdomain.com` 检查）
- ✅ 防火墙是否开放80端口
- ✅ 云服务器安全组是否配置
- ✅ Nginx是否正常运行（`sudo systemctl status nginx`）

### 3. Nginx配置测试失败

**解决方法**：
```bash
# 查看详细错误信息
sudo nginx -t

# 检查配置文件语法
sudo nginx -T | grep -A 20 "server_name"
```

## 后续步骤

配置完成后，您可能还需要：

1. **配置HTTPS（443端口）**：使用Let's Encrypt免费SSL证书
2. **更新环境变量**：将 `NEXT_PUBLIC_URL` 更新为新域名
3. **更新Clerk配置**：在Clerk Dashboard中添加新域名

## 相关文件

- `nginx-domain.conf` - Nginx配置文件模板
- `setup-domain.sh` - 自动配置脚本



