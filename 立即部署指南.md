# 立即部署指南

## 当前状态
- ✅ 网络连接正常
- ✅ 项目文件已上传
- ❌ 所有软件都未安装（需要安装）

## 执行部署

### 方法一：使用修复版本的脚本（推荐）

```bash
cd /var/www/maclock
chmod +x deploy-complete-fixed.sh
./deploy-complete-fixed.sh
```

这个脚本会：
1. 自动安装 Node.js、PM2、Docker
2. 启动数据库
3. 安装依赖并构建项目
4. 启动应用

**预计时间：15-20 分钟**

### 方法二：如果脚本仍然卡住，手动执行

如果修复版本的脚本仍然卡在 `apt-get update`，可以手动执行：

```bash
# 1. 设置非交互式模式
export DEBIAN_FRONTEND=noninteractive

# 2. 更新系统（可能需要 5-10 分钟）
apt-get update

# 3. 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt-get install -y nodejs

# 4. 安装 PM2
npm install -g pm2

# 5. 安装 Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
systemctl start docker

# 6. 安装 Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# 7. 启动数据库
cd /var/www/maclock
docker-compose up -d

# 8. 安装项目依赖
npm install

# 9. 生成 Prisma
npx prisma generate

# 10. 运行数据库迁移
npx prisma migrate deploy

# 11. 构建项目
npm run build

# 12. 启动服务
pm2 start npm --name maclock -- start
pm2 save
```

## 注意事项

1. **apt-get update 可能需要时间** - 第一次更新可能需要 5-10 分钟，请耐心等待
2. **如果卡住** - 等待 10 分钟后如果仍无响应，按 Ctrl+C 终止，然后手动执行上面的步骤
3. **环境变量** - 部署完成后记得配置 `.env.local` 文件

## 监控进度

在另一个终端窗口可以监控：

```bash
# 查看进程
ps aux | grep -E "(apt|npm|node|docker)"

# 查看磁盘使用
df -h

# 查看网络活动
iftop
```






