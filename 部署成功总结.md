# ğŸ‰ éƒ¨ç½²æˆåŠŸæ€»ç»“

## âœ… éƒ¨ç½²çŠ¶æ€

**åº”ç”¨å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œï¼**

- âœ… Node.js 20.19.5 å·²å®‰è£…
- âœ… PM2 è¿›ç¨‹ç®¡ç†å™¨å·²å®‰è£…å¹¶è¿è¡Œ
- âœ… Docker å’Œ Docker Compose å·²å®‰è£…
- âœ… PostgreSQL æ•°æ®åº“å·²å¯åŠ¨
- âœ… é¡¹ç›®ä¾èµ–å·²å®‰è£…
- âœ… Prisma Client å·²ç”Ÿæˆ
- âœ… æ•°æ®åº“è¿ç§»å·²å®Œæˆ
- âœ… Next.js é¡¹ç›®å·²æ„å»º
- âœ… PM2 æœåŠ¡å·²å¯åŠ¨ï¼ˆçŠ¶æ€ï¼šonlineï¼‰
- âœ… å¼€æœºè‡ªå¯å·²é…ç½®

## ğŸŒ è®¿é—®åº”ç”¨

### æœ¬åœ°è®¿é—®
```bash
curl http://localhost:3000
```

### å¤–éƒ¨è®¿é—®
- **IP åœ°å€**: http://38.175.195.104:3000
- **æœåŠ¡å™¨**: 38.175.195.104
- **ç«¯å£**: 3000

## ğŸ”§ æœåŠ¡ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
pm2 status
pm2 list
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
pm2 logs maclock

# æŸ¥çœ‹æœ€è¿‘ 50 è¡Œæ—¥å¿—
pm2 logs maclock --lines 50

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
pm2 logs maclock --follow
```

### æœåŠ¡æ§åˆ¶
```bash
# é‡å¯æœåŠ¡
pm2 restart maclock

# åœæ­¢æœåŠ¡
pm2 stop maclock

# å¯åŠ¨æœåŠ¡
pm2 start maclock

# åˆ é™¤æœåŠ¡
pm2 delete maclock
```

### ç›‘æ§æœåŠ¡
```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show maclock
```

## ğŸ”’ é‡è¦é…ç½®

### 1. é˜²ç«å¢™é…ç½®

ç¡®ä¿ç«¯å£ 3000 å·²å¼€æ”¾ï¼š

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
ufw status

# å¼€æ”¾ç«¯å£ 3000
ufw allow 3000/tcp

# å¦‚æœéœ€è¦ HTTP/HTTPS
ufw allow 80/tcp
ufw allow 443/tcp

# é‡å¯é˜²ç«å¢™
ufw reload
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

**é‡è¦**: éœ€è¦æ›´æ–° `.env.local` æ–‡ä»¶ä¸­çš„ API å¯†é’¥ï¼š

```bash
cd /var/www/maclock
nano .env.local
```

éœ€è¦æ›¿æ¢çš„å ä½ç¬¦ï¼š
- `STRIPE_SECRET_KEY` â†’ æ‚¨çš„ Stripe å¯†é’¥
- `NEXT_PUBLIC_STRIPE_PRICE_ID` â†’ æ‚¨çš„ Stripe Price ID
- `CLERK_PUBLISHABLE_KEY` â†’ æ‚¨çš„ Clerk å…¬é’¥
- `CLERK_SECRET_KEY` â†’ æ‚¨çš„ Clerk å¯†é’¥
- `RESEND_API_KEY` â†’ æ‚¨çš„ Resend API å¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

æ›´æ–°åé‡å¯æœåŠ¡ï¼š
```bash
pm2 restart maclock
```

### 3. Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨åŸŸåè®¿é—®ï¼Œé…ç½® Nginxï¼š

```bash
# å®‰è£… Nginx
apt-get install -y nginx

# åˆ›å»ºé…ç½®æ–‡ä»¶
nano /etc/nginx/sites-available/maclock
```

é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆå‚è€ƒ `nginx.conf.example`ï¼‰ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

å¯ç”¨ç«™ç‚¹ï¼š
```bash
ln -s /etc/nginx/sites-available/maclock /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

## ğŸ“Š æ•°æ®åº“ç®¡ç†

### æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
```bash
docker-compose ps
```

### è¿æ¥æ•°æ®åº“
```bash
docker-compose exec postgres psql -U maclock -d maclock
```

### å¤‡ä»½æ•°æ®åº“
```bash
docker-compose exec postgres pg_dump -U maclock maclock > backup_$(date +%Y%m%d).sql
```

### æ¢å¤æ•°æ®åº“
```bash
docker-compose exec -T postgres psql -U maclock maclock < backup_20241121.sql
```

## ğŸ”„ æ›´æ–°ä»£ç 

å½“éœ€è¦æ›´æ–°ä»£ç æ—¶ï¼š

```bash
cd /var/www/maclock

# 1. ä¸Šä¼ æ–°æ–‡ä»¶ï¼ˆä½¿ç”¨ WinSCP æˆ– gitï¼‰

# 2. å®‰è£…æ–°ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
npm install

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
npx prisma migrate deploy

# 4. é‡æ–°æ„å»º
npm run build

# 5. é‡å¯æœåŠ¡
pm2 restart maclock
```

## ğŸ› æ•…éšœæ’é™¤

### åº”ç”¨æ— æ³•è®¿é—®

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   pm2 status
   pm2 logs maclock
   ```

2. **æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬**
   ```bash
   netstat -tulpn | grep 3000
   ```

3. **æ£€æŸ¥é˜²ç«å¢™**
   ```bash
   ufw status
   ```

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. **æ£€æŸ¥æ•°æ®åº“å®¹å™¨**
   ```bash
   docker-compose ps
   docker-compose logs postgres
   ```

2. **æ£€æŸ¥ç¯å¢ƒå˜é‡**
   ```bash
   cat .env.local | grep DATABASE_URL
   ```

### æ„å»ºå¤±è´¥

1. **æ¸…ç†ç¼“å­˜**
   ```bash
   rm -rf node_modules .next
   npm install
   npm run build
   ```

2. **æ£€æŸ¥ Node.js ç‰ˆæœ¬**
   ```bash
   node -v  # åº”è¯¥æ˜¯ 18+ æˆ– 20+
   ```

## ğŸ“ å¸¸ç”¨æ£€æŸ¥æ¸…å•

- [ ] é˜²ç«å¢™å·²å¼€æ”¾ç«¯å£ 3000
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼ˆ.env.localï¼‰
- [ ] æ•°æ®åº“æ­£åœ¨è¿è¡Œ
- [ ] PM2 æœåŠ¡çŠ¶æ€ä¸º online
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•åº”ç”¨åŠŸèƒ½**
   - è®¿é—®é¦–é¡µ
   - æµ‹è¯•ç™»å½•åŠŸèƒ½
   - æµ‹è¯•æ”¯ä»˜æµç¨‹ï¼ˆå¦‚æœå·²é…ç½® Stripeï¼‰

2. **é…ç½®åŸŸå**ï¼ˆå¯é€‰ï¼‰
   - è®¾ç½® DNS è®°å½•
   - é…ç½® Nginx åå‘ä»£ç†
   - é…ç½® SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰

3. **ç›‘æ§å’Œç»´æŠ¤**
   - å®šæœŸæ£€æŸ¥æ—¥å¿—
   - ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨
   - å®šæœŸå¤‡ä»½æ•°æ®åº“

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- PM2 æ—¥å¿—ï¼š`pm2 logs maclock`
- ç³»ç»Ÿæ—¥å¿—ï¼š`journalctl -u pm2-root`
- æ•°æ®åº“æ—¥å¿—ï¼š`docker-compose logs postgres`

---

**æ­å–œï¼æ‚¨çš„ Maclock é¡¹ç›®å·²æˆåŠŸéƒ¨ç½²ï¼** ğŸ‰



