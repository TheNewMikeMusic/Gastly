# 清除浏览器缓存指南

## 问题确认
✅ 无痕窗口可以正常登录
❌ 正常窗口无法登录（401错误）

**原因：** PC浏览器缓存了旧的JavaScript代码和Clerk配置

## 解决方案

### 方法 1: 清除浏览器缓存（推荐）

#### Chrome/Edge 浏览器：
1. 按 `Ctrl+Shift+Delete` 打开清除浏览数据窗口
2. 时间范围选择：**"全部时间"**
3. 勾选以下选项：
   - ✅ **缓存的图片和文件**
   - ✅ **Cookie 和其他网站数据**（可选，但推荐）
4. 点击 **"清除数据"**
5. 关闭并重新打开浏览器
6. 访问：`http://38.175.195.104:3000/sign-in`

#### Firefox 浏览器：
1. 按 `Ctrl+Shift+Delete`
2. 时间范围选择：**"全部"**
3. 勾选：
   - ✅ **缓存**
   - ✅ **Cookie**（可选）
4. 点击 **"立即清除"**

### 方法 2: 硬刷新页面

在 Sign In 页面：
- **Windows**: `Ctrl+F5` 或 `Ctrl+Shift+R`
- **Mac**: `Cmd+Shift+R`

这会强制浏览器重新加载所有资源。

### 方法 3: 清除特定网站的缓存

#### Chrome/Edge：
1. 按 `F12` 打开开发者工具
2. 右键点击地址栏左侧的刷新按钮
3. 选择 **"清空缓存并硬性重新加载"**

#### 或者：
1. 按 `F12` 打开开发者工具
2. 右键点击 Network 标签页中的任意请求
3. 选择 **"Clear browser cache"**

### 方法 4: 使用无痕模式（临时方案）

如果暂时无法清除缓存，可以使用无痕模式：
- **Chrome**: `Ctrl+Shift+N`
- **Edge**: `Ctrl+Shift+N`
- **Firefox**: `Ctrl+Shift+P`

## 验证缓存已清除

清除缓存后，检查：

1. **浏览器控制台**：
   - `afterSignInUrl` deprecated 警告应该消失
   - 401错误应该消失

2. **Network 标签页**：
   - 所有请求应该返回 200 状态码
   - 不应该有红色的错误请求

3. **Sign In 页面**：
   - 应该正常显示登录表单
   - 不应该是空白页面

## 如果清除缓存后仍有问题

1. **检查服务器是否已重建**：
   ```bash
   cd /var/www/maclock
   pm2 logs maclock --lines 50
   ```
   查看是否有错误

2. **强制重建服务器**：
   ```bash
   chmod +x force-rebuild-pc-fix.sh
   ./force-rebuild-pc-fix.sh
   ```

3. **检查Clerk配置**：
   ```bash
   chmod +x check-clerk-api-config.sh
   ./check-clerk-api-config.sh
   ```

## 预防措施

为了避免将来出现缓存问题：

1. **开发时使用无痕模式**：避免缓存干扰
2. **定期清除缓存**：特别是在更新代码后
3. **使用版本号**：在生产环境中使用版本号来强制更新缓存

## 快速检查清单

- [ ] 已清除浏览器缓存（全部时间）
- [ ] 已关闭并重新打开浏览器
- [ ] 已访问 Sign In 页面
- [ ] 浏览器控制台没有错误
- [ ] Sign In 页面正常显示
- [ ] 可以正常登录


