# 服务器端部署命令（不使用 sshpass）

## 方案一: 安装 sshpass（推荐）

```bash
# Debian/Ubuntu 系统
apt-get update
apt-get install -y sshpass

# 然后执行部署命令
sshpass -p '0iHSn3CpCpDmlkub' scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/
sshpass -p '0iHSn3CpCpDmlkub' scp -o StrictHostKeyChecking=no deploy-complete.sh root@38.175.195.104:/var/www/maclock/
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'cd /var/www/maclock && chmod +x deploy-complete.sh && npm install && ./deploy-complete.sh'
```

## 方案二: 使用 SSH 密钥（免密登录，推荐用于生产环境）

```bash
# 1. 生成 SSH 密钥（如果还没有）
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""

# 2. 复制公钥到目标服务器
ssh-copy-id -o StrictHostKeyChecking=no root@38.175.195.104
# 输入密码: 0iHSn3CpCpDmlkub

# 3. 测试免密登录
ssh root@38.175.195.104 'echo "连接成功"'

# 4. 部署（无需密码）
scp -r deploy-temp/* root@38.175.195.104:/var/www/maclock/
scp deploy-complete.sh root@38.175.195.104:/var/www/maclock/
ssh root@38.175.195.104 'cd /var/www/maclock && chmod +x deploy-complete.sh && npm install && ./deploy-complete.sh'
```

## 方案三: 手动输入密码（临时方案）

```bash
# 1. 上传文件（会提示输入密码，输入: 0iHSn3CpCpDmlkub）
scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/

# 2. 上传部署脚本
scp -o StrictHostKeyChecking=no deploy-complete.sh root@38.175.195.104:/var/www/maclock/

# 3. 连接到服务器并执行部署
ssh -o StrictHostKeyChecking=no root@38.175.195.104
# 输入密码: 0iHSn3CpCpDmlkub

# 在服务器上执行：
cd /var/www/maclock
chmod +x deploy-complete.sh
npm install
./deploy-complete.sh
```

## 方案四: 使用 expect（自动化输入密码）

```bash
# 安装 expect
apt-get update
apt-get install -y expect

# 创建部署脚本
cat > deploy-auto.sh << 'EOF'
#!/usr/bin/expect -f
set timeout 300
set password "0iHSn3CpCpDmlkub"
set server "38.175.195.104"
set user "root"

# 上传文件
spawn scp -r -o StrictHostKeyChecking=no deploy-temp/* ${user}@${server}:/var/www/maclock/
expect {
    "password:" { send "${password}\r" }
    "yes/no" { send "yes\r"; exp_continue }
}
expect eof

# 上传部署脚本
spawn scp -o StrictHostKeyChecking=no deploy-complete.sh ${user}@${server}:/var/www/maclock/
expect {
    "password:" { send "${password}\r" }
    "yes/no" { send "yes\r"; exp_continue }
}
expect eof

# 执行部署
spawn ssh -o StrictHostKeyChecking=no ${user}@${server} "cd /var/www/maclock && chmod +x deploy-complete.sh && npm install && ./deploy-complete.sh"
expect {
    "password:" { send "${password}\r" }
    "yes/no" { send "yes\r"; exp_continue }
}
expect eof
EOF

chmod +x deploy-auto.sh
./deploy-auto.sh
```

## 快速执行（推荐：先安装 sshpass）

```bash
# 一键安装并部署
apt-get update && apt-get install -y sshpass && \
sshpass -p '0iHSn3CpCpDmlkub' scp -r -o StrictHostKeyChecking=no deploy-temp/* root@38.175.195.104:/var/www/maclock/ && \
sshpass -p '0iHSn3CpCpDmlkub' scp -o StrictHostKeyChecking=no deploy-complete.sh root@38.175.195.104:/var/www/maclock/ && \
sshpass -p '0iHSn3CpCpDmlkub' ssh -o StrictHostKeyChecking=no root@38.175.195.104 'cd /var/www/maclock && chmod +x deploy-complete.sh && npm install && ./deploy-complete.sh'
```

